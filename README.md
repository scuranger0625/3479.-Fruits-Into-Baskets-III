# 樹中有樹：用 Segment Tree + Fenwick Tree 解決區間條件查詢問題

這是一份使用「Segment Tree（線段樹）包 Fenwick Tree（又稱 Binary Indexed Tree）」的進階資料結構範例，用來解決 LeetCode 題目中「將水果放入最小可容納的籃子」的問題。

與常見的 multiset / TreeMap 解法不同，本實作使用了更通用的資料結構設計，雖然常數較大，但擁有更強的擴展性與可重用性，特別適合處理**需要區間查詢 + 條件篩選**的進階題型。

| 項目                     | 標準解法（multiset / TreeMap） | 本專案（Segment Tree + Fenwick Tree） |
| ---------------------- | ------------------------ | -------------------------------- |
| 查詢速度                   | O(log n)                 | O(log² n)（但支援更多功能）               |
| 支援區間查詢                 | ❌                        | ✅ 可以查詢任意 \[L, R] 區間              |
| 支援條件篩選（如：找區間內 ≥ x 的個數） | ❌                        | ✅                                |
| 擴展性（應用到二維/多維、次數限制等）    | 弱                        | 強                                |
| 適合線上查詢（Online Query）   | 普通                       | ✅                                |
| 記憶體占用                  | 少                        | 多，但可優化                           |

📌 總結：雖然本解法在小型資料下效能不敵簡單做法，但在 需要處理動態資料、區間查詢、多維篩選、頻繁更新 的情境中，將展現出壓倒性的優勢！

🌲 簡單解釋：Segment Tree 是什麼？
Segment Tree（線段樹）是一種能快速查詢 數列中一段區間的資訊 的資料結構，常用於：

區間總和

區間最大 / 最小值

區間頻率統計

想像它是一棵二元樹，每個節點代表數列中某一段的區間。例如：節點 1 負責 [0, n)，它的左右子節點分別負責 [0, n/2) 和 [n/2, n)。

查詢與更新的時間複雜度都是 O(log n)。

🌱 Fenwick Tree 是什麼？
Fenwick Tree（又稱 Binary Indexed Tree, BIT）是一種支援 前綴和查詢與單點更新 的資料結構，適合用來處理：

數值出現次數統計

排名統計

升冪/降冪查找

它的時間複雜度也是 O(log n)，實作上比 Segment Tree 更簡潔。

🌳「樹中有樹」是怎麼做的？
這裡我們實作了一種 Segment Tree of Fenwick Tree 的資料結構：

外層的 Segment Tree 負責劃分「籃子的 index 區間」，例如：03, 47...

每個節點內建一顆 Fenwick Tree，用來統計這段區間內有哪些容量值出現（進行座標壓縮）

這樣就能達到：

查詢 [0..n) 區間內，有沒有任何籃子容量 ≥ 某個水果重量？

也就是：「在某段區間內，有沒有符合條件的數？」

這種設計比傳統的 set / map 更進階，支援更多複雜應用。
